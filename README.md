
# Poryadki Docker Application

Это руководство описывает, как собрать, запустить приложение "poryadki" с использованием Docker и получить результат его работы на операционных системах Windows и Linux. Приложение работает в фоновом режиме, постоянно сохраняя результаты своей деятельности в файл.

## Оглавление
1.  [Предварительные требования](#предварительные-требования)
    *   [Windows](#windows)
    *   [Linux](#linux)
2.  [Клонирование репозитория](#клонирование-репозитория)
3.  [Сборка Docker-образа](#сборка-docker-образа)
4.  [Запуск Docker-контейнера в фоновом режиме](#запуск-docker-контейнера-в-фоновом-режиме)
    *   [Базовый запуск](#базовый-запуск)
    *   [Запуск с ограничением ресурсов](#запуск-с-ограничением-ресурсов)
5.  [Просмотр логов работающего контейнера](#просмотр-логов-работающего-контейнера)
6.  [**Получение результатов перед остановкой контейнера (ОБЯЗАТЕЛЬНО!)**](#получение-результатов-перед-остановкой-контейнера-обязательно)
7.  [Остановка и удаление контейнера](#остановка-и-удаление-контейнера)
8.  [Устранение неполадок Docker Hub](#устранение-неполадок-docker-hub)
    *   [Проблема: `401 Unauthorized` или `incorrect username or password`](#проблема-401-unauthorized-или-incorrect-username-or-password)
9.  [Полезные Docker-команды](#полезные-docker-команды)

## 1. Предварительные требования

### Windows
*   **Docker Desktop:** Установите последнюю версию Docker Desktop для Windows с [официального сайта](https://www.docker.com/products/docker-desktop/). Docker Desktop включает Docker Engine, Docker CLI, Docker Compose и графический интерфейс.
*   **WSL 2 (рекомендуется):** Убедитесь, что у вас установлена и включена Windows Subsystem for Linux 2. Docker Desktop использует WSL 2 для лучшей производительности. Инструкции по установке можно найти на [сайте Microsoft](https://docs.microsoft.com/en-us/windows/wsl/install).
    *   **Настройка ресурсов WSL 2 (опционально):** Для тонкой настройки ресурсов, выделяемых всем дистрибутивам WSL 2 (и, следовательно, Docker Desktop), создайте или измените файл `.wslconfig` в вашей папке пользователя (`C:\Users\<ВашеИмяПользователя>\.wslconfig`):
        ```ini
        [wsl2]
        memory=4GB  # Например, 4 ГБ ОЗУ
        processors=2 # Например, 2 логических процессора
        ```
        Перезапустите WSL (`wsl --shutdown` в PowerShell), чтобы изменения вступили в силу. Docker Desktop перезапустит WSL автоматически.

### Linux
*   **Docker Engine и Docker CLI:** Установите Docker Engine и Docker CLI для вашего дистрибутива Linux. Следуйте официальным инструкциям:
    *   [Ubuntu](https://docs.docker.com/engine/install/ubuntu/)
    *   [Debian](https://docs.docker.com/engine/install/debian/)
    *   [CentOS](https://docs.docker.com/engine/install/centos/)
    *   [Fedora](https://docs.docker.com/engine/install/fedora/)
    *   Другие дистрибутивы: [см. документацию Docker](https://docs.docker.com/engine/install/#server)
*   **Управление Docker как non-root пользователь (рекомендуется):** Чтобы избежать использования `sudo` для каждой команды Docker, добавьте своего пользователя в группу `docker`:
    ```bash
    sudo groupadd docker # Если группа еще не существует
    sudo usermod -aG docker $USER
    ```
    Затем выйдите из системы и войдите снова, или выполните `newgrp docker`, чтобы изменения применились к текущей сессии.

## 2. Клонирование репозитория

Откройте терминал (PowerShell или CMD на Windows, или ваш терминал на Linux) и выполните следующую команду, чтобы клонировать репозиторий:

```bash
git clone https://github.com/MrDenyGrom/poryadki.git
cd poryadki
```

## 3. Сборка Docker-образа

Находясь в корневой директории проекта (`poryadki`, где расположен `Dockerfile`), выполните команду для сборки Docker-образа:

```bash
docker build -t poryadki-app:latest .
```
*   `-t poryadki-app:latest`: задает имя (`poryadki-app`) и тег (`latest`) для вашего образа.
*   `.`: указывает, что `Dockerfile` и контекст сборки находятся в текущей директории.

Если в процессе сборки возникнет ошибка, связанная с базовым образом (например, `maven:3.9-eclipse-temurin-22`), см. раздел [Устранение неполадок Docker Hub](#устранение-неполадок-docker-hub).

## 4. Запуск Docker-контейнера в фоновом режиме

После успешной сборки образа, вы можете запустить контейнер. Приложение будет работать в фоновом режиме.

### Базовый запуск

```bash
docker run -d --name poryadki-instance poryadki-app:latest
```
*   `-d`: **(detached)** запускает контейнер в фоновом режиме. Управление сразу вернется в терминал.
*   `--name poryadki-instance`: Присваивает контейнеру имя `poryadki-instance` для удобства обращения к нему позже.

### Запуск с ограничением ресурсов

Вы можете ограничить количество CPU и памяти, доступное контейнеру:

```bash
docker run -d --name poryadki-instance-limited --cpus="1.5" --memory="1g" poryadki-app:latest
```
*   `--cpus="1.5"`: выделяет контейнеру максимум 1.5 ядра CPU.
*   `--memory="1g"`: выделяет контейнеру максимум 1 гигабайт оперативной памяти (можно использовать `m` для мегабайт, например, `512m`).

**Примечание для Windows:** Глобальные лимиты ресурсов для Docker Desktop (WSL 2) настраиваются, как описано в разделе [Предварительные требования (Windows)](#windows). Лимиты, указанные при `docker run`, не могут превышать глобальные лимиты Docker Desktop.
**Примечание для Linux:** Docker на Linux использует cgroups ядра для управления ресурсами.

Контейнер будет работать в фоне.

## 5. Просмотр логов работающего контейнера

Вы можете в любой момент посмотреть логи вашего работающего скрипта:

```bash
docker logs -f poryadki-instance
```
*   `-f` или `--follow`: Следить за выводом логов в реальном времени. Нажмите `Ctrl+C`, чтобы прекратить слежение.
Если вы использовали другое имя для контейнера (например, `poryadki-instance-limited`), используйте его.

## 6. **Получение результатов перед остановкой контейнера (ОБЯЗАТЕЛЬНО!)**

Приложение постоянно сохраняет результаты своей работы в файл `balonin`, находящийся в корневой директории внутри контейнера.

**КРИТИЧЕСКИ ВАЖНО:** Прежде чем остановить или удалить контейнер, необходимо скопировать этот файл на ваш компьютер. Если вы остановите и удалите контейнер без предварительного копирования, **все несохраненные данные в файле `balonin` будут утеряны**, так как файл существует только во временной файловой системе контейнера.

**Процедура получения результатов:**

1.  **Убедитесь, что контейнер запущен:**
    ```bash
    docker ps
    ```
    Найдите контейнер по имени (`poryadki-instance` или другое заданное вами).

2.  **Скопируйте файл `balonin` из работающего контейнера:**
    ```bash
    docker cp poryadki-instance:/balonin <путь_куда_скопировать_на_хосте>/balonin
    ```
    **Пример (копирование в текущую директорию на хосте):**
    ```bash
    docker cp poryadki-instance:/balonin ./balonin_results
    ```
    (Рекомендуется добавлять суффикс типа `_results` или дату, чтобы не перезаписать предыдущие копии, если вы делаете это несколько раз).

    Или, если вы хотите скопировать в конкретную папку, например, `C:\Results` на Windows:
    ```bash
    docker cp poryadki-instance:/balonin C:\Results\balonin
    ```
    Или `/home/user/results/` на Linux:
    ```bash
    docker cp poryadki-instance:/balonin /home/user/results/balonin
    ```
    Замените `<путь_куда_скопировать_на_хосте>` на желаемый путь на вашем компьютере. Файл `balonin` будет скопирован из корневой директории (`/`) контейнера.

Вы можете выполнять эту операцию копирования несколько раз, пока контейнер работает, чтобы получать промежуточные результаты.

## 7. Остановка и удаление контейнера

После того как вы **скопировали файл с результатами (`balonin`)**, вы можете остановить и удалить контейнер.

1.  **Остановка контейнера:**
    ```bash
    docker stop poryadki-instance
    ```
    Эта команда отправит сигнал SIGTERM приложению в контейнере (и через некоторое время SIGKILL, если оно не остановится само).

2.  **Удаление контейнера:**
    После остановки контейнер все еще существует в системе. Чтобы его удалить (освободить имя и ресурсы):
    ```bash
    docker rm poryadki-instance
    ```
    **ВНИМАНИЕ:** После выполнения `docker rm` файловая система контейнера и все данные внутри (включая файл `balonin`, если вы его не скопировали) будут безвозвратно удалены.

## 8. Устранение неполадок Docker Hub

### Проблема: `401 Unauthorized` или `incorrect username or password`
Эта ошибка возникает, когда Docker не может аутентифицироваться на Docker Hub для скачивания базового образа.

**Решение:** Войдите в Docker Hub.

1.  **Убедитесь, что у вас есть аккаунт** на [Docker Hub](https://hub.docker.com/).
2.  **Выполните выход (на всякий случай):**
    ```bash
    docker logout
    ```
3.  **Выполните вход:**
    ```bash
    docker login
    ```
    Или, если у вас возникли проблемы с автоматическим определением имени пользователя или сохраненными учетными данными:
    ```bash
    docker login -u ВАШ_DOCKER_ID
    ```
    Замените `ВАШ_DOCKER_ID` на ваше имя пользователя Docker Hub.
4.  **Следуйте инструкциям:** Вас могут попросить ввести пароль или пройти аутентификацию через браузер (с вводом одноразового кода).
5.  **Проверьте вход через Docker Desktop (Windows):** Убедитесь, что вы также вошли в систему через интерфейс Docker Desktop.
6.  **Если проблема сохраняется (радикальный метод):**
    *   Закройте Docker Desktop (Windows) или остановите сервис Docker (Linux).
    *   Найдите и сделайте резервную копию файла `config.json` Docker (обычно `~/.docker/config.json` на Linux/macOS или `C:\Users\<ВашеИмяПользователя>\.docker\config.json` на Windows).
    *   Удалите оригинальный `config.json`.
    *   Запустите Docker Desktop/сервис Docker.
    *   Повторите `docker login`.

После успешного входа повторите [Сборку Docker-образа](#сборка-docker-образа).

## 9. Полезные Docker-команды

*   `docker ps`: Показать запущенные контейнеры.
*   `docker ps -a`: Показать все контейнеры (включая остановленные).
*   `docker images`: Показать список локальных образов.
*   `docker rmi <ID_образа_или_имя:тег>`: Удалить образ.
*   `docker system prune`: Удалить все неиспользуемые контейнеры, сети, образы (и опционально тома). Используйте с осторожностью.
*   `docker exec -it <ID_контейнера_или_имя> /bin/bash` (или `/bin/sh`): Открыть интерактивную сессию внутри работающего контейнера (полезно для отладки).

---
